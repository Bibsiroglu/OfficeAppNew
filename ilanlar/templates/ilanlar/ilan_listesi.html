{% extends 'base.html' %}
{% load static %}
{% load tz %}
{% now "Y-m-d" as bugun_tarih %}

{% block title %}TÃ¼m Ä°lanlarÄ±n Listesi{% endblock title %}

{% block content %}

{% with toplam_ilan_sayisi=bugun_kalkan_ilanlar.count|add:diger_ilanlar.count|add:yarin_kalkan_ilanlar.count %}
<h2 class="mb-4">Emlak Ä°lanlarÄ± (Toplam {{ toplam_ilan_sayisi }} Ä°lan)</h2>
{% endwith %}

{# ========================================================================= #}
{# UYARI KARTLARI BLOKU (LISTENIN DIÅžINA TAÅžINDI) #}
{# ========================================================================= #}
<div class="row">

    {# YARIN KALKACAK Ä°LANLAR UYARISI #}
    {% if yarin_kalkan_ilanlar %}
    <div class="col-md-6 mb-3">
        <div class="card text-white bg-warning shadow border-warning">
            <div class="card-body">
                <h5 class="card-title"><i class="fas fa-clock"></i>
                    ðŸŸ¡ YARIN YAYINDAN KALKIYOR ({{ yarin_kalkan_ilanlar.count }} Ä°lan)
                </h5>
                <p class="card-text">AÅŸaÄŸÄ±daki {{ yarin_kalkan_ilanlar.count }} ilan yarÄ±n yayÄ±ndan
                    kaldÄ±rÄ±lacaktÄ±r.</p>
                <ul class="list-unstyled">
                    {% for ilan in yarin_kalkan_ilanlar %}
                    <li>
                        <a href="{% url 'ilan_detay' pk=ilan.pk %}" class="text-white">
                            #{{ ilan.ilan_no }} - {{ ilan.baslik|truncatechars:30 }}</a>
                    </li>
                    {% endfor %}
                </ul>
            </div>
        </div>
    </div>
    {% endif %}

    {# BUGÃœN KALKACAK Ä°LANLAR UYARISI #}
    {% if bugun_kalkan_ilanlar %}
    <div class="col-md-6 mb-3">
        <div class="card text-white bg-danger shadow border-danger">
            <div class="card-body">
                <h5 class="card-title"><i class="fas fa-exclamation-triangle"></i>
                    ðŸ”´ BUGÃœN YAYINDAN KALKIYOR ({{ bugun_kalkan_ilanlar.count }} Ä°lan)
                </h5>
                <p class="card-text">AÅŸaÄŸÄ±daki {{ bugun_kalkan_ilanlar.count }} ilan bugÃ¼n yayÄ±ndan
                    kaldÄ±rÄ±lacaktÄ±r. Acil aksiyon gereklidir!</p>
                <ul class="list-unstyled">
                    {% for ilan in bugun_kalkan_ilanlar %}
                    <li>
                        <a href="{% url 'ilan_detay' pk=ilan.pk %}" class="text-white">
                            #{{ ilan.ilan_no }} - {{ ilan.baslik|truncatechars:30 }}
                        </a>
                    </li>
                    {% endfor %}
                </ul>
            </div>
        </div>
    </div>
    {% endif %}
</div>
{# --- UYARI KARTLARI BLOKU BÄ°TTÄ° --- #}

<div class="list-group shadow-sm">
    {# --- BAÅžLIK SATIRI (Sabit) --- #}
    <div class="list-group-item list-group-item-action bg-light text-muted d-none d-md-flex py-3">
        <div class="col-md-2 fw-bold">Ä°lan No / Kategori</div>
        <div class="col-md-4 fw-bold">BaÅŸlÄ±k / Konum</div>
        <div class="col-md-2 fw-bold text-center">Oda / Alan (mÂ²)</div>
        <div class="col-md-2 fw-bold text-center">Fiyat / Tip</div>
        <div class="col-md-2 fw-bold text-center">KayÄ±t / KalkÄ±ÅŸ Tarihi</div>
    </div>

    {# ========================================================================= #}
    {# BÃ–LÃœM 1: BUGÃœN KALKACAK Ä°LANLARIN LÄ°STESÄ° (Ã‡Ä°FT GÃ–STERÄ°MÄ° Ã–NLEMEK Ä°Ã‡Ä°N KULLANILMADI) #}
    {# ========================================================================= #}

    {# ========================================================================= #}
    {# BÃ–LÃœM 2: DÄ°ÄžER TÃœM Ä°LANLAR (Normal Liste) #}
    {# ========================================================================= #}
    {% for ilan in diger_ilanlar %}
    {% comment %} Dikkat: bugun/yarin kalkanlar diger_ilanlar'dan hariÃ§ tutulmalÄ±dÄ±r. {% endcomment %}
    {% include 'ilanlar/parca_ilan_satiri.html' with ilan=ilan uyari_sinifi="" %}
    {% empty %}
    <div class="list-group-item">
        <p class="alert alert-info mb-0">Sistemde kayÄ±tlÄ± ilan bulunmamaktadÄ±r.</p>
    </div>
    {% endfor %}

</div>

{% comment %} Sayfalama (Pagination) kÄ±smÄ± {% endcomment %}
{% if is_paginated %}
<nav aria-label="Sayfalar" class="mt-4">
    <ul class="pagination justify-content-center">
        {% if page_obj.has_previous %}
        <li class="page-item"><a class="page-link" href="?page={{ page_obj.previous_page_number }}">Ã–nceki</a></li>
        {% endif %}

        <li class="page-item active"><span class="page-link">{{ page_obj.number }} / {{ page_obj.paginator.num_pages
                }}</span></li>

        {% if page_obj.has_next %}
        <li class="page-item"><a class="page-link" href="?page={{ page_obj.next_page_number }}">Sonraki</a></li>
        {% endif %}
    </ul>
</nav>
{% endif %}

{% endblock content %}